import pandas as pd

trigger_events = []

# Retrieve L_max for comparison
L_max = gov.L_max

for event_time in gov.events:
    # Find the index closest to the event_time in the time array
    idx = np.searchsorted(time, event_time)
    # Get the corresponding xi and eta values at that time
    xi_at_trigger = states[idx, 0]
    eta_at_trigger = states[idx, 1]

    # Determine the reason for the trigger
    trigger_reason = []
    if eta_at_trigger <= 0.05:
        trigger_reason.append('eta <= 0.05')
    if xi_at_trigger >= 0.9 * L_max:
        trigger_reason.append(f'xi >= 0.9 * L_max ({0.9 * L_max:.2f})')

    trigger_events.append({
        'Time (s)': event_time,
        'Ergonomic Load (xi)': xi_at_trigger,
        'Stability Buffer (eta)': eta_at_trigger,
        'Trigger Reason': ', '.join(trigger_reason)
    })

# Create a DataFrame for better visualization
trigger_df = pd.DataFrame(trigger_events)
print("AETM Trigger Moments and Conditions:")
display(trigger_df)
